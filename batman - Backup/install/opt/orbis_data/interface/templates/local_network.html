{% extends "base.html" %}

{% block content %}
<section class="card-grid">
    <h2 class="card-grid-title">IP &amp; SSID Configuration</h2>

    <article class="card">
        <h2 class="card-title">IP (WiFi & Ethernet)</h2>
        <p>
            Current IP:
            <span class="mono text-ok">{{ current_ip_with_suffix }}</span>
        </p>

        <form class="form form-inline" method="post" action="{{ url_for('local_network_set_ip') }}"
              onsubmit="return confirm('Saving these settings will reboot the system. Continue?');">
            <div class="form-grid-2">
                <div class="form-group">
                    <label for="ip_address">New IP</label>
                    <input type="text" id="ip_address" name="ip_address" placeholder="e.g. 192.168.200.10" required>
                </div>
                <div class="form-group">
                    <label for="ip_suffix">New Suffix</label>
                    <input type="number" id="ip_suffix" name="ip_suffix" min="0" max="32" placeholder="e.g. 24" required>
                </div>
            </div>
            <div class="form-actions">
                <button type="submit" class="btn-primary">Save</button>
            </div>
        </form>
    </article>

    <article class="card">
        <h2 class="card-title">Local SSID</h2>
        <p>
            Current SSID:
            <span class="mono text-ok">{{ current_ssid }}</span>
        </p>

        
        <form class="form form-inline" method="post" action="{{ url_for('local_network_set_ssid') }}"
              onsubmit="return confirm('Saving these settings will reboot the system. Continue?');">
            <div class="form-group">
                <label for="ssid_value">New SSID</label>
                <input type="text" id="ssid_value" name="ssid_value" placeholder="New SSID" required>
            </div>

            <div class="form-group">
                <label for="wifi_passphrase">New Password</label>
                <input type="password" id="wifi_passphrase" name="wifi_passphrase"
                       placeholder="New password" autocomplete="new-password">
            </div>

            <div class="form-actions">
                <button type="submit" class="btn-primary">Save</button>
            </div>
        </form>


        <form class="form form-inline" method="post" action="{{ url_for('local_network_set_wifi') }}"
              onsubmit="return confirm('Saving these settings will reboot the system. Continue?');">
            <div class="form-grid-2">
                <div class="form-group">
                    <label for="country_code">Country Code</label>
                    <select id="country_code" name="country_code" required>
                        {% for code in countries %}
                            <option value="{{ code }}" {% if code == current_country_code %}selected{% endif %}>{{ code }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="wifi_channel">Channel</label>
                    <select id="wifi_channel" name="wifi_channel" required>
                        {% for ch in range(1, 15) %}
                            <option value="{{ ch }}" {% if ch == current_channel %}selected{% endif %}>{{ ch }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn-primary">Save</button>
            </div>
        </form>


        <script>
            (function () {
                const countryEl = document.getElementById("country_code");
                const channelEl = document.getElementById("wifi_channel");

                function maxChannelForCountry(code) {
                    // Conservative 2.4 GHz mapping:
                    // US/CA/MX: 1–11, JP: 1–14, most others: 1–13
                    const c = (code || "").toUpperCase();
                    if (c === "JP") return 14;
                    if (c === "US" || c === "CA" || c === "MX") return 11;
                    return 13;
                }

                function applyChannelRules() {
                    const maxCh = maxChannelForCountry(countryEl.value);
                    const current = parseInt(channelEl.value, 10) || 1;

                    for (const opt of channelEl.options) {
                        const ch = parseInt(opt.value, 10);
                        opt.disabled = (ch > maxCh);
                    }

                    if (current > maxCh) {
                        channelEl.value = String(maxCh);
                    }
                }

                countryEl.addEventListener("change", applyChannelRules);
                applyChannelRules();
            })();
        </script>
    </article>
</section>

<section class="card-grid">
    <h2 class="card-grid-title">DHCP Configuration</h2>

    <article class="card">
        <h2 class="card-title">Placeholder 1</h2>
        <p class="card-text">–</p>
    </article>
    <article class="card">
        <h2 class="card-title">Placeholder 2</h2>
        <p class="card-text">–</p>
    </article>
    <article class="card">
        <h2 class="card-title">Placeholder 3</h2>
        <p class="card-text">–</p>
    </article>
    <article class="card">
        <h2 class="card-title">Placeholder 4</h2>
        <p class="card-text">–</p>
    </article>
</section>
{% endblock %}
